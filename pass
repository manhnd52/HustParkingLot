def parkLot_manage():
    	xoamanhinh()
	print("Quản lý bãi đỗ xe")
        print("1. Thêm bãi đỗ xe")
        print("2. Xóa bãi đỗ xe")
        print("3. Xem danh sách bãi đỗ xe")
        print("4. Cập nhật thông tin bãi đỗ xe")
        print("5. Quay lại")
        command(add_park_lot, delete_park_lot, view_park_lots, modify_park_lot, success_admin_login)

def add_park_lot():
	xoamanhinh()
        print("Thêm bãi đỗ xe")
	while True:
            try:
                name = input("Nhập tên bãi đỗ xe: ")
                capacity = int(input("Nhập sức chứa của bãi đỗ xe: "))
                
                with psycopg2.connect(**conn_params) as conn:
                    with conn.cursor() as cursor:
                        try:
                            cursor.execute("INSERT INTO parking_lot (name, capacity) VALUES (%s, %s)", (name, capacity))
                            conn.commit()
                            print("Thêm bãi đỗ xe thành công!")
                            break
                        except Exception as e:
                            print(f"Đã xảy ra lỗi khi thêm bãi đỗ xe: {e}")
            except ValueError:
                print("Giá trị nhập vào không hợp lệ, vui lòng nhập lại.")
    print("1. Thêm bãi đỗ xe khác")
    print("2. Quay lại")
    command(add_park_lot, parkLot_manage)


def delete_park_lot():
	xoamanhinh()
    	print("Xóa bãi đỗ xe")
        while True:
            try:
                park_lot_id = int(input("Nhập ID bãi đỗ xe cần xóa: "))
                
                with psycopg2.connect(**conn_params) as conn:
                    with conn.cursor() as cursor:
                        cursor.execute("SELECT * FROM parking_lot WHERE parkinglotid = %s", (park_lot_id,))
                        park_lot = cursor.fetchone()
                        
                        if park_lot:
                            confirm = input(f"Bạn có chắc chắn muốn xóa bãi đỗ xe '{park_lot[1]}' không? (y/n): ")
                            if confirm.lower() == 'y':
                                try:
                                    cursor.execute("DELETE FROM parking_lot WHERE parkinglotid = %s", (park_lot_id,))
                                    conn.commit()
                                    print("Xóa bãi đỗ xe thành công!")
                                    break
                                except Exception as e:
                                    print(f"Đã xảy ra lỗi khi xóa bãi đỗ xe: {e}")
                            else:
                                print("Hủy bỏ xóa bãi đỗ xe.")
                                break
                        else:
                            print("Không tìm thấy bãi đỗ xe với ID đã nhập. Vui lòng thử lại.")
            except ValueError:
                print("Giá trị nhập vào không hợp lệ, vui lòng nhập lại.")
    print("1. Xóa bãi đỗ xe khác")
    print("2. Quay lại")
    command(delete_park_lot, parkLot_manage)

def view_park_lots():
    	xoamanhinh()
        with psycopg2.connect(**conn_params) as conn:
            with conn.cursor() as cursor:
                try:
                    cursor.execute("SELECT * FROM parking_lot")
                    park_lots = cursor.fetchall()
                    
                    if park_lots:
                        for lot in park_lots:
                            print(f"ID: {lot[0]}, Name: {lot[1]}, Capacity: {lot[2]}")
                    else:
                        print("Không có bãi đỗ xe nào.")
                except Exception as e:
                    print(f"Đã xảy ra lỗi: {e}")

 def modify_park_lot():
	xoamanhinh()
	print("Sửa bãi đỗ xe")
        while True:
            try:
                park_lot_id = int(input("Nhập ID bãi đỗ xe cần cập nhật: "))
                
                with psycopg2.connect(**conn_params) as conn:
                    with conn.cursor() as cursor:
                        cursor.execute("SELECT * FROM parking_lot WHERE parkinglotid = %s", (park_lot_id,))
                        park_lot = cursor.fetchone()
                        
                        if park_lot:
                            print(f"ID: {park_lot[0]}, Name: {park_lot[1]}, Capacity: {park_lot[2]}")
                            name = input(f"Nhập tên mới của bãi đỗ xe (nhấn Enter để giữ nguyên '{park_lot[1]}'): ") or park_lot[1]
                            capacity = input(f"Nhập sức chứa mới của bãi đỗ xe (nhấn Enter để giữ nguyên '{park_lot[2]}'): ")
                            capacity = int(capacity) if capacity else park_lot[2]
                            
                            try:
                                cursor.execute("UPDATE parking_lot SET name = %s, capacity = %s WHERE parkinglotid = %s", 
                                               (name, capacity, park_lot_id))
                                conn.commit()
                                print("Cập nhật bãi đỗ xe thành công!")
                                break
                            except Exception as e:
                                print(f"Đã xảy ra lỗi khi cập nhật bãi đỗ xe: {e}")
                        else:
                            print("Không tìm thấy bãi đỗ xe với ID đã nhập. Vui lòng thử lại.")
            except ValueError:
                print("Giá trị nhập vào không hợp lệ, vui lòng nhập lại.")
    print("1. Tiếp tục sửa")
    print("2. Quay lại")
    command(modify_park_lot, parkLot_manage)
    

